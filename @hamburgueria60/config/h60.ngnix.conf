# H60 NGNIX ports
#
# ports:
# hamburgueria60.com, delivery.hamburgueria60.com ..... 3000
# preview.hamburgueria60.com .......................... 3010
# Unknown service (probably socket) ................... 8000
#
# restaurant.hamburgueria60.com ....................... 3020
# preview.restaurant.hamburgueria60.com ............... 3021
#
# api.hamburgueria60.com .............................. 5000
# preview.api.hamburgueria60.com ...................... 5001
#

# # hamburgueria60.com # 3000
# server {
#   server_name hamburgueria60.com;
#
#   location /
#   {
#     proxy_pass http://127.0.0.1:3000/;
#     include /etc/nginx/proxy_params;
#   }
#
#   # Socket (working on 80)
#   location /socket.io
#   {
#     proxy_set_header Upgrade $http_upgrade;
#     proxy_set_header Connection "upgrade";
#     proxy_http_version 1.1;
#     proxy_set_header XForwardedFor $proxy_add_x_forwarded_for;
#     proxy_set_header Host $host;
#     proxy_pass http://127.0.0.1:3000/socket.io;
#   }
#
#   if ( $scheme = "https" ) {
#     return 301 http://$host$request_uri;
#   }
#
#   listen [::]:443 ssl ipv6only=on;
#   listen 443 ssl;
#   ssl_certificate /etc/letsencrypt/live/hamburgueria60.com/fullchain.pem;
#   ssl_certificate_key /etc/letsencrypt/live/hamburgueria60.com/privkey.pem;
#   include /etc/letsencrypt/options-ssl-nginx.conf;
#   ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;
# }

# delivery.hamburgueria60.com # 3000
server {
  server_name delivery.hamburgueria60.com;

  location /
  {
    proxy_pass http://127.0.0.1:3000/;
    include /etc/nginx/proxy_params;
  }

  # Socket (working on 80)
  location /socket.io
  {
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "upgrade";
    proxy_http_version 1.1;
    proxy_set_header XForwardedFor $proxy_add_x_forwarded_for;
    proxy_set_header Host $host;
    proxy_pass http://127.0.0.1:3000/socket.io;
  }

  listen 80 ;
  listen [::]:80 ;

  listen 443 ssl;
  ssl_certificate /etc/letsencrypt/live/hamburgueria60.com/fullchain.pem;
  ssl_certificate_key /etc/letsencrypt/live/hamburgueria60.com/privkey.pem;
  include /etc/letsencrypt/options-ssl-nginx.conf;
  ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;

  if ( $scheme = "https" ) {
    return 301 http://$host$request_uri;
  }
}

# # preview.delivery.hamburgueria60.com # 3010
# server {
#   server_name preview.delivery.hamburgueria60.com;
#   location /
#   {
#     proxy_pass http://127.0.0.1:3010/;
#     include /etc/nginx/proxy_params;
#   }
#
#   # if ( $scheme = "http" ) {
#   #   return 301 https://$host$request_uri;
#   # }
#
#   listen 443 ssl;
#   ssl_certificate /etc/letsencrypt/live/hamburgueria60.com/fullchain.pem;
#   ssl_certificate_key /etc/letsencrypt/live/hamburgueria60.com/privkey.pem;
#   include /etc/letsencrypt/options-ssl-nginx.conf;
#   ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;
# }
#
# (probably) socket, idk
server {
  listen 8000;
  listen [::]:8000;
  location /
  {
    proxy_pass http://127.0.0.1:3000;
    include /etc/nginx/proxy_params;
  }
}

# # restaurant.hamburgueria60.com;
# server {
#   server_name restaurant.hamburgueria60.com;
#
#   location /
#   {
#     proxy_pass http://127.0.0.1:3020/;
#     include /etc/nginx/proxy_params;
#   }
#
#   listen [::]:443 ssl;
#   listen 443 ssl;
#   ssl_certificate /etc/letsencrypt/live/hamburgueria60.com/fullchain.pem;
#   ssl_certificate_key /etc/letsencrypt/live/hamburgueria60.com/privkey.pem;
#   include /etc/letsencrypt/options-ssl-nginx.conf;
#   ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;
# }

# preview.restaurant.hamburgueria60.com;
server {
  server_name preview.restaurant.hamburgueria60.com;

  location /
  {
    proxy_pass http://127.0.0.1:3021/;
    include /etc/nginx/proxy_params;
  }

  listen [::]:443 ssl;
  listen 443 ssl;
  ssl_certificate /etc/letsencrypt/live/hamburgueria60.com/fullchain.pem;
  ssl_certificate_key /etc/letsencrypt/live/hamburgueria60.com/privkey.pem;
  include /etc/letsencrypt/options-ssl-nginx.conf;
  ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;
}

# api.hamburgueria60.com;
server {
  server_name api.hamburgueria60.com;

  location /
  {
    proxy_pass http://127.0.0.1:5000/;
    include /etc/nginx/proxy_params;
  }

  listen [::]:443 ssl;
  listen 443 ssl;
  ssl_certificate /etc/letsencrypt/live/hamburgueria60.com/fullchain.pem;
  ssl_certificate_key /etc/letsencrypt/live/hamburgueria60.com/privkey.pem;
  include /etc/letsencrypt/options-ssl-nginx.conf;
  ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;
}

# preview.api.hamburgueria60.com;
server {
  server_name preview.api.hamburgueria60.com;

  location /
  {
    proxy_pass http://127.0.0.1:5000/;
    include /etc/nginx/proxy_params;
  }

  listen [::]:443 ssl;
  listen 443 ssl;
  ssl_certificate /etc/letsencrypt/live/hamburgueria60.com/fullchain.pem;
  ssl_certificate_key /etc/letsencrypt/live/hamburgueria60.com/privkey.pem;
  include /etc/letsencrypt/options-ssl-nginx.conf;
  ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;
}

# # HTTPS redirect: hamburgueria60
# server {
#   if ($host = hamburgueria60.com) {
#     return 301 https://$host$request_uri;
#   }
#
#   server_name hamburgueria60.com;
#
#   listen 80 ;
#   listen [::]:80 ;
# }

# HTTPS redirect: preview.delivery
# server {
#   if ($host = preview.delivery.hamburgueria60.com) {
#     return 301 https://$host$request_uri;
#   }
#
#   server_name preview.delivery.hamburgueria60.com;
#
#   listen 80 ;
#   listen [::]:80 ;
# }

# HTTPS redirect: restaurant, preview
server {
  if ($host = preview.restaurant.hamburgueria60.com) {
    return 301 https://$host$request_uri;
  }

  if ($host = api.hamburgueria60.com) {
    return 301 https://$host$request_uri;
  }

  if ($host = preview.api.hamburgueria60.com) {
    return 301 https://$host$request_uri;
  }


  server_name preview.restaurant.hamburgueria60.com api.hamburgueria60.com preview.api.hamburgueria60.com;

  listen 80 ;
  listen [::]:80 ;

  return 404;
}
